ä¸ªäººè´¢åŠ¡è®°è´¦ç³»ç»Ÿ - è¯¦ç»†è®¾è®¡æ–¹æ¡ˆ
ä¸€ã€é¡¹ç›®æ¦‚è¿°
1.1 é¡¹ç›®å®šä½
ä¸€ä¸ªé¢å‘å¤§å­¦ç”Ÿå’Œå¹´è½»ç¾¤ä½“çš„è½»é‡çº§ä¸ªäººè´¢åŠ¡ç®¡ç†ç³»ç»Ÿ,å¸®åŠ©ç”¨æˆ·è®°å½•æ—¥å¸¸æ”¶æ”¯ã€åˆ†ææ¶ˆè´¹ä¹ æƒ¯ã€åˆ¶å®šé¢„ç®—è®¡åˆ’,åŸ¹å…»è‰¯å¥½çš„ç†è´¢æ„è¯†ã€‚
1.2 æ ¸å¿ƒä»·å€¼

è®°è´¦ä¾¿æ·:å¿«é€Ÿè®°å½•æ¯ç¬”æ”¶æ”¯
æ•°æ®å¯è§†:å›¾è¡¨å±•ç¤ºæ¶ˆè´¹ç»“æ„
é¢„ç®—ç®¡ç†:è®¾ç½®é¢„ç®—å¹¶è¿½è¸ªå®Œæˆæƒ…å†µ
ä¹ æƒ¯åˆ†æ:å‘ç°æ¶ˆè´¹æ¨¡å¼å’Œä¼˜åŒ–ç©ºé—´

1.3 æŠ€æœ¯äº®ç‚¹

ğŸ“Š ä¸°å¯Œçš„æ•°æ®å¯è§†åŒ–(EChartså¤šç»´åº¦å›¾è¡¨)
ğŸ’° å¤æ‚çš„é‡‘é¢è®¡ç®—å’Œç»Ÿè®¡é€»è¾‘
ğŸ“± å“åº”å¼è®¾è®¡,æ”¯æŒç§»åŠ¨ç«¯
ğŸ” å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œæ•°æ®éš”ç¦»
ğŸ“ˆ é¢„ç®—é¢„è­¦å’Œæ™ºèƒ½æé†’


äºŒã€åŠŸèƒ½æ¨¡å—è¯¦ç»†è®¾è®¡
2.1 ç”¨æˆ·è®¤è¯æ¨¡å—
åŠŸèƒ½ç‚¹:

ç”¨æˆ·æ³¨å†Œ(é‚®ç®±/æ‰‹æœºå·)
ç”¨æˆ·ç™»å½•(JWT Tokenè®¤è¯)
å¯†ç æ‰¾å›
ä¸ªäººä¿¡æ¯ç¼–è¾‘

æŠ€æœ¯å®ç°:

å‰ç«¯è¡¨å•éªŒè¯(é‚®ç®±æ ¼å¼ã€å¯†ç å¼ºåº¦)
åç«¯JWTç”Ÿæˆå’ŒéªŒè¯
å¯†ç åŠ å¯†å­˜å‚¨(BCrypt)
Tokenåˆ·æ–°æœºåˆ¶


2.2 è®°è´¦æ ¸å¿ƒæ¨¡å—
2.2.1 å¿«é€Ÿè®°è´¦
ç•Œé¢è®¾è®¡:
+---------------------------+
|    æ”¶å…¥  |  æ”¯å‡º  |  è½¬è´¦  |  (Tabåˆ‡æ¢)
+---------------------------+
| é‡‘é¢: Â¥ [_______]         |
| åˆ†ç±»: [é¤é¥® â–¼]            |
| è´¦æˆ·: [å¾®ä¿¡ â–¼]            |
| æ—¶é—´: [2024-12-12 â–¼]     |
| å¤‡æ³¨: [_____________]     |
|                           |
|      [å–æ¶ˆ]  [ä¿å­˜]       |
+---------------------------+
åˆ†ç±»ä½“ç³»:
æ”¯å‡ºåˆ†ç±»:

ğŸ” é¤é¥®(æ—©é¤/åˆé¤/æ™šé¤/å¤œå®µ/é›¶é£Ÿ/é¥®æ–™)
ğŸš‡ äº¤é€š(åœ°é“/å…¬äº¤/æ‰“è½¦/åŠ æ²¹)
ğŸ® å¨±ä¹(ç”µå½±/æ¸¸æˆ/KTV/æ—…æ¸¸)
ğŸ›’ è´­ç‰©(è¡£æœ/é‹å­/æ—¥ç”¨å“/æ•°ç )
ğŸ“š å­¦ä¹ (ä¹¦ç±/è¯¾ç¨‹/æ–‡å…·)
ğŸ¥ åŒ»ç–—(çœ‹ç—…/ä¹°è¯/ä½“æ£€)
ğŸ  å±…ä½(æˆ¿ç§Ÿ/æ°´ç”µ/ç‰©ä¸š)
ğŸ“± é€šè®¯(è¯è´¹/å®½å¸¦)
ğŸ‘¥ ç¤¾äº¤(ç¤¼ç‰©/èšé¤/çº¢åŒ…)
ğŸ’„ ç¾å®¹(æŠ¤è‚¤/ç¾å‘/åŒ–å¦†å“)
ğŸƒ è¿åŠ¨(å¥èº«/è£…å¤‡)
ğŸ• å® ç‰©(é£Ÿå“/åŒ»ç–—/ç”¨å“)
ğŸ“¦ å…¶ä»–

æ”¶å…¥åˆ†ç±»:

ğŸ’° å·¥èµ„
ğŸ å¥–é‡‘
ğŸ’¸ å…¼èŒ
ğŸ“ˆ æŠ•èµ„æ”¶ç›Š
ğŸ§§ çº¢åŒ…
ğŸ’³ é€€æ¬¾
ğŸ“¦ å…¶ä»–

è´¦æˆ·ç±»å‹:

ğŸ’³ ç°é‡‘
ğŸ¦ é“¶è¡Œå¡(æ”¯æŒå¤šå¼ )
ğŸ’š å¾®ä¿¡
ğŸ’™ æ”¯ä»˜å®
ğŸ’› é¥­å¡
ğŸ“¦ å…¶ä»–

æ•°æ®åº“è®¾è®¡:
sql-- è´¦å•è¡¨
CREATE TABLE transactions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    type ENUM('income', 'expense', 'transfer') NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    category_id INT NOT NULL,
    account_id INT NOT NULL,
    to_account_id INT NULL, -- è½¬è´¦ç›®æ ‡è´¦æˆ·
    transaction_date DATETIME NOT NULL,
    remark VARCHAR(200),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_date (user_id, transaction_date),
    INDEX idx_category (category_id)
);

-- åˆ†ç±»è¡¨
CREATE TABLE categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    type ENUM('income', 'expense') NOT NULL,
    icon VARCHAR(50),
    parent_id INT NULL, -- æ”¯æŒäºŒçº§åˆ†ç±»
    sort_order INT DEFAULT 0
);

-- è´¦æˆ·è¡¨
CREATE TABLE accounts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    name VARCHAR(50) NOT NULL,
    type ENUM('cash', 'bank', 'wechat', 'alipay', 'other') NOT NULL,
    balance DECIMAL(10,2) DEFAULT 0,
    initial_balance DECIMAL(10,2) DEFAULT 0, -- åˆå§‹ä½™é¢
    icon VARCHAR(50),
    is_default BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

### 2.3 è´¦å•ç®¡ç†æ¨¡å—

#### 2.3.1 è´¦å•åˆ—è¡¨
**åŠŸèƒ½:**
- æŒ‰æ—¥æœŸåˆ†ç»„å±•ç¤º
- æ˜¾ç¤ºæ¯æ—¥æ”¶æ”¯æ±‡æ€»
- æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½
- å¿«é€Ÿç¼–è¾‘/åˆ é™¤

**ç•Œé¢å¸ƒå±€:**
```
+---------------------------+
| [ç­›é€‰] [æœç´¢]   [æœ¬æœˆâ–¼]   |
+---------------------------+
| 2024å¹´12æœˆ12æ—¥  æ”¶Â¥200 æ”¯Â¥156
+---------------------------+
| ğŸ” åˆé¤          -Â¥35.00  |
|    éº¦å½“åŠ³å¥—é¤    12:30    |
+---------------------------+
| ğŸš‡ åœ°é“          -Â¥6.00   |
|    å›å®¶          18:20    |
+---------------------------+
| 2024å¹´12æœˆ11æ—¥  æ”¶Â¥0 æ”¯Â¥89
+---------------------------+
| ...                       |
+---------------------------+
2.3.2 ç­›é€‰åŠŸèƒ½

æ—¶é—´èŒƒå›´ç­›é€‰(ä»Šå¤©/æœ¬å‘¨/æœ¬æœˆ/è‡ªå®šä¹‰)
åˆ†ç±»ç­›é€‰(å¤šé€‰)
è´¦æˆ·ç­›é€‰
æ”¶æ”¯ç±»å‹ç­›é€‰
é‡‘é¢åŒºé—´ç­›é€‰
å…³é”®è¯æœç´¢(å¤‡æ³¨)

ç­›é€‰å™¨APIè®¾è®¡:
javascriptGET /api/transactions?
    userId=123
    &startDate=2024-12-01
    &endDate=2024-12-31
    &type=expense
    &categoryIds=1,2,3
    &accountIds=1,2
    &minAmount=0
    &maxAmount=1000
    &keyword=åˆé¤
    &page=1
    &pageSize=20
```

---

### 2.4 æ•°æ®ç»Ÿè®¡æ¨¡å—

#### 2.4.1 é¦–é¡µä»ªè¡¨ç›˜

**å…³é”®æŒ‡æ ‡:**
```
+---------------------------+
|    æœ¬æœˆæ”¶æ”¯æ¦‚è§ˆ            |
+---------------------------+
|  æ”¶å…¥: Â¥5,000            |
|  æ”¯å‡º: Â¥3,245   å‰©ä½™65%   |
|  ç»“ä½™: Â¥1,755   â†‘ 12%    |
+---------------------------+
|    [æœ¬å‘¨] [æœ¬æœˆ] [æœ¬å¹´]   |
+---------------------------+
æ”¯å‡ºè¶‹åŠ¿å›¾(æŠ˜çº¿å›¾):

Xè½´:æ—¥æœŸ
Yè½´:é‡‘é¢
å±•ç¤ºæœ€è¿‘7å¤©/30å¤©çš„æ¯æ—¥æ”¯å‡ºè¶‹åŠ¿

åˆ†ç±»å æ¯”å›¾(é¥¼å›¾):

å±•ç¤ºæœ¬æœˆå„åˆ†ç±»æ”¯å‡ºå æ¯”
ç‚¹å‡»å¯æŸ¥çœ‹åˆ†ç±»è¯¦æƒ…

æ”¶æ”¯å¯¹æ¯”å›¾(æŸ±çŠ¶å›¾):

å¯¹æ¯”æœ€è¿‘6ä¸ªæœˆçš„æ”¶æ”¯æƒ…å†µ

2.4.2 è¯¦ç»†ç»Ÿè®¡é¡µé¢
æ—¶é—´ç»´åº¦:

æ—¥ç»Ÿè®¡
å‘¨ç»Ÿè®¡
æœˆç»Ÿè®¡
å¹´ç»Ÿè®¡
è‡ªå®šä¹‰æ—¶é—´æ®µ

ç»Ÿè®¡ç»´åº¦:

æŒ‰åˆ†ç±»ç»Ÿè®¡

å„åˆ†ç±»é‡‘é¢å’Œå æ¯”
åŒæ¯”/ç¯æ¯”å¢é•¿


æŒ‰è´¦æˆ·ç»Ÿè®¡

å„è´¦æˆ·æ”¶æ”¯æƒ…å†µ
è´¦æˆ·ä½™é¢å˜åŒ–


æŒ‰æ—¶é—´ç»Ÿè®¡

æ¯æ—¥/æ¯å‘¨/æ¯æœˆè¶‹åŠ¿
å·¥ä½œæ—¥vså‘¨æœ«æ¶ˆè´¹å¯¹æ¯”


æ¶ˆè´¹æ’è¡Œ

å•ç¬”é‡‘é¢TOP10
æ¶ˆè´¹é¢‘æ¬¡æœ€é«˜çš„åˆ†ç±»



æ ¸å¿ƒSQLæŸ¥è¯¢ç¤ºä¾‹:
sql-- æŒ‰åˆ†ç±»ç»Ÿè®¡æœ¬æœˆæ”¯å‡º
SELECT 
    c.name as category_name,
    SUM(t.amount) as total_amount,
    COUNT(*) as count,
    ROUND(SUM(t.amount) / (
        SELECT SUM(amount) 
        FROM transactions 
        WHERE user_id = ? 
        AND type = 'expense'
        AND MONTH(transaction_date) = MONTH(CURRENT_DATE)
    ) * 100, 2) as percentage
FROM transactions t
JOIN categories c ON t.category_id = c.id
WHERE t.user_id = ?
AND t.type = 'expense'
AND MONTH(t.transaction_date) = MONTH(CURRENT_DATE)
GROUP BY t.category_id, c.name
ORDER BY total_amount DESC;

2.5 é¢„ç®—ç®¡ç†æ¨¡å—
2.5.1 é¢„ç®—è®¾ç½®
é¢„ç®—ç±»å‹:

æ€»é¢„ç®—(æ¯æœˆæ€»æ”¯å‡ºé™é¢)
åˆ†ç±»é¢„ç®—(é¤é¥®ã€äº¤é€šç­‰å•ç‹¬è®¾ç½®)

é¢„ç®—å‘¨æœŸ:

æœˆåº¦é¢„ç®—(æœ€å¸¸ç”¨)
å¹´åº¦é¢„ç®—

æ•°æ®åº“è®¾è®¡:
sqlCREATE TABLE budgets (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    category_id INT NULL, -- NULLè¡¨ç¤ºæ€»é¢„ç®—
    amount DECIMAL(10,2) NOT NULL,
    period_type ENUM('monthly', 'yearly') NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE,
    alert_threshold INT DEFAULT 80, -- é¢„è­¦é˜ˆå€¼(ç™¾åˆ†æ¯”)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.5.2 é¢„ç®—ç›‘æ§

**é¢„ç®—å¡ç‰‡æ˜¾ç¤º:**
```
+---------------------------+
| ğŸ” é¤é¥®é¢„ç®—               |
+---------------------------+
| å·²ç”¨: Â¥856 / Â¥1000       |
| [==========85%========>  ]|
| å‰©ä½™: Â¥144 (è¿˜æœ‰20å¤©)     |
| âš ï¸ æ¥è¿‘é¢„ç®—é™é¢!          |
+---------------------------+
```

**é¢„è­¦æœºåˆ¶:**
- è¾¾åˆ°80%æ—¶é»„è‰²é¢„è­¦
- è¾¾åˆ°100%æ—¶çº¢è‰²è­¦å‘Š
- è¶…å‡ºé¢„ç®—æ—¶ç‰¹åˆ«æç¤º

**é¢„ç®—åˆ†æ:**
- é¢„ç®—å®Œæˆç‡è¶‹åŠ¿
- å†å²é¢„ç®—æ‰§è¡Œæƒ…å†µ
- é¢„ç®—vså®é™…æ”¯å‡ºå¯¹æ¯”

---

### 2.6 è´¦æˆ·ç®¡ç†æ¨¡å—

#### 2.6.1 è´¦æˆ·æ€»è§ˆ
```
+---------------------------+
|    æ€»èµ„äº§: Â¥12,450        |
+---------------------------+
| ğŸ’³ ç°é‡‘          Â¥350    |
| ğŸ¦ å·¥å•†é“¶è¡Œ      Â¥8,500  |
| ğŸ’š å¾®ä¿¡          Â¥2,100  |
| ğŸ’™ æ”¯ä»˜å®        Â¥1,500  |
+---------------------------+
|   [+ æ·»åŠ è´¦æˆ·]            |
+---------------------------+
2.6.2 è´¦æˆ·è¯¦æƒ…

è´¦æˆ·ä½™é¢å˜åŒ–æ›²çº¿
è¯¥è´¦æˆ·çš„æ‰€æœ‰äº¤æ˜“è®°å½•
æ”¶æ”¯ç»Ÿè®¡

2.6.3 è´¦æˆ·é—´è½¬è´¦

é€‰æ‹©è½¬å‡ºè´¦æˆ·å’Œè½¬å…¥è´¦æˆ·
è®°å½•è½¬è´¦é‡‘é¢
è‡ªåŠ¨è°ƒæ•´ä¸¤ä¸ªè´¦æˆ·ä½™é¢

è½¬è´¦é€»è¾‘:
python# FastAPI + SQLAlchemy å®ç°
async def transfer(from_account_id: int, to_account_id: int, amount: float, db: Session):
    # å¼€å¯äº‹åŠ¡
    try:
        # 1. æ‰£å‡è½¬å‡ºè´¦æˆ·
        from_account = db.query(Account).filter(Account.id == from_account_id).first()
        if from_account.balance < amount:
            raise ValueError("ä½™é¢ä¸è¶³")
        from_account.balance -= amount

        # 2. å¢åŠ è½¬å…¥è´¦æˆ·
        to_account = db.query(Account).filter(Account.id == to_account_id).first()
        to_account.balance += amount

        # 3. è®°å½•è½¬è´¦äº¤æ˜“
        transfer_transaction = Transaction(
            user_id=from_account.user_id,
            type="transfer",
            amount=amount,
            account_id=from_account_id,
            to_account_id=to_account_id,
            transaction_date=datetime.now(),
            remark=f"è½¬è´¦è‡³ {to_account.name}"
        )
        db.add(transfer_transaction)

        db.commit()
    except Exception as e:
        db.rollback()
        raise e

2.7 æŠ¥è¡¨å¯¼å‡ºæ¨¡å—
2.7.1 Excelå¯¼å‡º
å¯¼å‡ºå†…å®¹:

è´¦å•æ˜ç»†(æ‰€æœ‰å­—æ®µ)
åˆ†ç±»ç»Ÿè®¡æ±‡æ€»
æœˆåº¦æŠ¥è¡¨

æŠ€æœ¯å®ç°(åç«¯):
python# FastAPI + openpyxl å®ç°
from fastapi import Response
from openpyxl import Workbook
from io import BytesIO

@app.get("/api/statistics/export/excel")
async def export_excel(current_user: User = Depends(get_current_user)):
    workbook = Workbook()

    # Sheet1: è´¦å•æ˜ç»†
    sheet1 = workbook.active
    sheet1.title = "è´¦å•æ˜ç»†"

    # åˆ›å»ºè¡¨å¤´
    headers = ["æ—¥æœŸ", "ç±»å‹", "åˆ†ç±»", "é‡‘é¢", "è´¦æˆ·", "å¤‡æ³¨"]
    for col, header in enumerate(headers, 1):
        sheet1.cell(row=1, column=col, value=header)

    # å¡«å……æ•°æ®
    transactions = get_user_transactions(current_user.id)
    for row, transaction in enumerate(transactions, 2):
        sheet1.cell(row=row, column=1, value=transaction.transaction_date.strftime("%Y-%m-%d"))
        sheet1.cell(row=row, column=2, value=transaction.type)
        sheet1.cell(row=row, column=3, value=transaction.category.name)
        sheet1.cell(row=row, column=4, value=float(transaction.amount))
        sheet1.cell(row=row, column=5, value=transaction.account.name)
        sheet1.cell(row=row, column=6, value=transaction.remark or "")

    # Sheet2: ç»Ÿè®¡æ±‡æ€»
    sheet2 = workbook.create_sheet("ç»Ÿè®¡æ±‡æ€»")
    # ... ç»Ÿè®¡æ•°æ®å¡«å……é€»è¾‘

    # ä¿å­˜åˆ°å­—èŠ‚æµ
    output = BytesIO()
    workbook.save(output)
    output.seek(0)

    filename = f"è´¦å•_{datetime.now().strftime('%Y%m%d')}.xlsx"
    headers = {
        "Content-Disposition": f"attachment; filename={filename}",
        "Content-Type": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    }

    return Response(
        content=output.getvalue(),
        headers=headers,
        media_type="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    )
2.7.2 PDFæŠ¥è¡¨
æœˆåº¦æŠ¥è¡¨å†…å®¹:

å°é¢(æœˆä»½ã€ç”¨æˆ·å)
æ”¶æ”¯æ€»è§ˆ
æ”¯å‡ºé¥¼å›¾
è¶‹åŠ¿æŠ˜çº¿å›¾
åˆ†ç±»æ˜ç»†è¡¨


2.8 å¾®ä¿¡è´¦å•å¯¼å…¥æ¨¡å—
2.8.1 æ‰‹åŠ¨å¯¼å‡º+æ™ºèƒ½è§£æ

åŠŸèƒ½æ¦‚è¿°:
ç”¨æˆ·é€šè¿‡å¾®ä¿¡å¯¼å‡ºè´¦å•CSVæ–‡ä»¶ï¼Œç³»ç»Ÿè‡ªåŠ¨è§£æå¹¶æ™ºèƒ½åˆ†ç±»å¯¼å…¥ï¼Œæ— éœ€APIæƒé™

ç”¨æˆ·æ“ä½œæµç¨‹:
```
å¾®ä¿¡ â†’ æˆ‘ â†’ æœåŠ¡ â†’ é’±åŒ… â†’ è´¦å• â†’ å¯¼å‡ºè´¦å•(CSV)
â†“
æœ¬ç³»ç»Ÿ â†’ ä¸Šä¼ CSVæ–‡ä»¶ â†’ æ™ºèƒ½è§£æ â†’ é¢„è§ˆç¡®è®¤ â†’ æ‰¹é‡å¯¼å…¥
â†“
è‡ªåŠ¨åˆ†ç±» â†’ é‡å¤æ£€æµ‹ â†’ æ•°æ®ç»Ÿè®¡
```

æŠ€æœ¯å®ç°:
å‰ç«¯æ–‡ä»¶å¤„ç†:
javascript// å¾®ä¿¡è´¦å•æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
<template>
  <div class="wechat-bill-import">
    <el-upload
      class="upload-area"
      drag
      accept=".csv"
      :before-upload="validateFile"
      :on-success="handleFileSuccess"
      :on-error="handleFileError"
      action="/api/wechat-bill/parse"
      :show-file-list="false"
    >
      <el-icon class="upload-icon"><Upload /></el-icon>
      <div class="upload-text">
        <p>ç‚¹å‡»æˆ–æ‹–æ‹½å¾®ä¿¡è´¦å•CSVæ–‡ä»¶åˆ°æ­¤å¤„</p>
        <p class="upload-tip">æ”¯æŒå¾®ä¿¡è´¦å•CSVæ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡10MB</p>
      </div>
    </el-upload>

    <!-- å¯¼å…¥é¢„è§ˆ -->
    <div v-if="previewData" class="preview-section">
      <h3>å¯¼å…¥é¢„è§ˆ (å…±{{ previewData.length }}æ¡è®°å½•)</h3>
      <el-table :data="previewData.slice(0, 10)" max-height="300">
        <el-table-column prop="transactionDate" label="æ—¶é—´" width="180"/>
        <el-table-column prop="merchantName" label="å•†æˆ·" width="200"/>
        <el-table-column prop="amount" label="é‡‘é¢" width="120">
          <template #default="scope">
            <span :class="scope.row.type === 'expense' ? 'text-red' : 'text-green'">
              {{ scope.row.type === 'expense' ? '-' : '+' }}Â¥{{ scope.row.amount }}
            </span>
          </template>
        </el-table-column>
        <el-table-column prop="categoryName" label="åˆ†ç±»" width="120"/>
        <el-table-column prop="accountName" label="è´¦æˆ·" width="120"/>
      </el-table>

      <div class="import-actions">
        <el-button @click="selectAll">å…¨é€‰</el-button>
        <el-button @click="deselectAll">å–æ¶ˆå…¨é€‰</el-button>
        <el-button type="primary" @click="confirmImport" :loading="importing">
          ç¡®è®¤å¯¼å…¥ ({{ selectedItems.length }}æ¡)
        </el-button>
      </div>
    </div>

    <!-- å¯¼å…¥ç»“æœ -->
    <div v-if="importResult" class="result-section">
      <el-result :icon="importResult.success ? 'success' : 'warning'">
        <template #title>
          å¯¼å…¥å®Œæˆï¼æˆåŠŸ{{ importResult.successCount }}æ¡ï¼Œå¤±è´¥{{ importResult.failCount }}æ¡
        </template>
        <template #extra>
          <el-button type="primary" @click="viewTransactions">æŸ¥çœ‹äº¤æ˜“è®°å½•</el-button>
          <el-button @click="importMore">ç»§ç»­å¯¼å…¥</el-button>
        </template>
      </el-result>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { parseWechatBill, importTransactions } from '@/api/wechat'

const previewData = ref([])
const selectedItems = ref([])
const importing = ref(false)
const importResult = ref(null)

const validateFile = (file) => {
  const isCSV = file.name.toLowerCase().endsWith('.csv')
  const isLt10M = file.size / 1024 / 1024 < 10

  if (!isCSV) {
    ElMessage.error('åªæ”¯æŒCSVæ ¼å¼çš„æ–‡ä»¶')
    return false
  }
  if (!isLt10M) {
    ElMessage.error('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB')
    return false
  }
  return true
}

const handleFileSuccess = async (response) => {
  if (response.code === 200) {
    previewData.value = response.data.map(item => ({
      ...item,
      selected: true
    }))
    selectedItems.value = previewData.value
    ElMessage.success(`æˆåŠŸè§£æ${previewData.value.length}æ¡è®°å½•`)
  } else {
    ElMessage.error(response.message || 'æ–‡ä»¶è§£æå¤±è´¥')
  }
}

const confirmImport = async () => {
  if (selectedItems.value.length === 0) {
    ElMessage.warning('è¯·é€‰æ‹©è¦å¯¼å…¥çš„è®°å½•')
    return
  }

  importing.value = true
  try {
    const result = await importTransactions(selectedItems.value)
    importResult.value = result.data
    ElMessage.success('å¯¼å…¥å®Œæˆ')
  } catch (error) {
    ElMessage.error('å¯¼å…¥å¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    importing.value = false
  }
}
</script>
```

åç«¯è§£ææœåŠ¡:
python# å¾®ä¿¡è´¦å•è§£ææœåŠ¡
import csv
import io
import re
from datetime import datetime
from typing import List, Dict, Optional
from fastapi import UploadFile, HTTPException
from sqlalchemy.orm import Session

from app.models.transaction import Transaction
from app.models.category import Category
from app.services.intelligent_category import IntelligentCategoryService

class WeChatBillService:
    def __init__(self, db: Session):
        self.db = db
        self.category_service = IntelligentCategoryService(db)

    async def parse_wechat_csv(self, file: UploadFile) -> List[Dict]:
        """è§£æå¾®ä¿¡è´¦å•CSVæ–‡ä»¶"""
        try:
            content = await file.read()
            # å¤„ç†å¾®ä¿¡CSVç¼–ç é—®é¢˜
            if content.startswith(b'\xEF\xBB\xBF'):  # UTF-8 BOM
                content = content[3:]

            csv_content = content.decode('utf-8').strip()
            lines = csv_content.split('\n')

            # æŸ¥æ‰¾æ•°æ®å¼€å§‹ä½ç½®ï¼ˆè·³è¿‡å¾®ä¿¡è´¦å•å¤´éƒ¨ä¿¡æ¯ï¼‰
            data_start = 0
            for i, line in enumerate(lines):
                if 'äº¤æ˜“æ—¶é—´' in line and 'äº¤æ˜“å¯¹æ–¹' in line and 'é‡‘é¢' in line:
                    data_start = i + 1
                    break

            if data_start == 0:
                raise HTTPException(status_code=400, detail="æ— æ³•è¯†åˆ«çš„å¾®ä¿¡è´¦å•æ ¼å¼")

            transactions = []
            for line in lines[data_start:]:
                if not line.strip() or line.startswith('---'):
                    continue

                try:
                    transaction = self._parse_transaction_line(line)
                    if transaction:
                        # æ™ºèƒ½åˆ†ç±»
                        transaction['categoryId'], transaction['categoryName'] = \
                            self.category_service.intelligent_match_category(
                                transaction['merchantName'],
                                transaction.get('wechatCategory', '')
                            )

                        # è®¾ç½®é»˜è®¤è´¦æˆ·
                        transaction['accountName'] = 'å¾®ä¿¡'

                        transactions.append(transaction)
                except Exception as e:
                    print(f"è§£æè¡Œå¤±è´¥: {line}, é”™è¯¯: {e}")
                    continue

            return transactions

        except UnicodeDecodeError:
            raise HTTPException(status_code=400, detail="æ–‡ä»¶ç¼–ç é”™è¯¯ï¼Œè¯·ç¡®ä¿ä¸ºUTF-8ç¼–ç ")
        except Exception as e:
            raise HTTPException(status_code=500, detail=f"è§£æå¤±è´¥: {str(e)}")

    def _parse_transaction_line(self, line: str) -> Optional[Dict]:
        """è§£æå•è¡Œäº¤æ˜“æ•°æ®"""
        # å¾®ä¿¡CSVæ ¼å¼: äº¤æ˜“æ—¶é—´,äº¤æ˜“ç±»å‹,äº¤æ˜“å¯¹æ–¹,å•†å“åç§°,æ”¶/æ”¯,é‡‘é¢(å…ƒ),æ”¯ä»˜æ–¹å¼,å½“å‰çŠ¶æ€,äº¤æ˜“å•å·,å•†æˆ·å•å·,å¤‡æ³¨
        parts = line.replace('"', '').split(',')

        if len(parts) < 6:
            return None

        try:
            transaction_date = parts[0].strip()
            transaction_type = parts[1].strip()
            merchant_name = parts[2].strip()
            product_name = parts[3].strip()
            income_expense = parts[4].strip()
            amount = float(parts[5].strip())

            # åˆ¤æ–­äº¤æ˜“ç±»å‹
            if income_expense == 'æ”¯å‡º':
                trans_type = 'expense'
                amount = abs(amount)
            elif income_expense == 'æ”¶å…¥':
                trans_type = 'income'
                amount = abs(amount)
            else:
                return None  # å¿½ç•¥å…¶ä»–ç±»å‹

            # è§£ææ—¥æœŸæ—¶é—´
            try:
                # å¾®ä¿¡æ ¼å¼: 2024-12-12 12:30:45
                date_obj = datetime.strptime(transaction_date, '%Y-%m-%d %H:%M:%S')
            except ValueError:
                # å…¼å®¹å…¶ä»–æ ¼å¼
                date_obj = datetime.strptime(transaction_date, '%Y-%m-%d')

            return {
                'transactionDate': date_obj.strftime('%Y-%m-%d %H:%M:%S'),
                'type': trans_type,
                'merchantName': merchant_name,
                'productName': product_name,
                'amount': round(amount, 2),
                'wechatCategory': transaction_type,
                'remark': f'{merchant_name} - {product_name}' if product_name else merchant_name,
                'source': 'wechat',
                'wechatTransactionId': parts[8].strip() if len(parts) > 8 else None
            }

        except (ValueError, IndexError) as e:
            print(f"è§£æäº¤æ˜“è¡Œå¤±è´¥: {line}, é”™è¯¯: {e}")
            return None

    async def import_transactions(self, user_id: int, transactions: List[Dict]) -> Dict:
        """å¯¼å…¥äº¤æ˜“è®°å½•"""
        success_count = 0
        fail_count = 0
        duplicate_count = 0

        for trans_data in transactions:
            try:
                # æ£€æŸ¥é‡å¤æ•°æ®
                if trans_data.get('wechatTransactionId'):
                    existing = self.db.query(Transaction).filter(
                        Transaction.user_id == user_id,
                        Transaction.wechat_transaction_id == trans_data['wechatTransactionId']
                    ).first()

                    if existing:
                        duplicate_count += 1
                        continue

                # è·å–æˆ–åˆ›å»ºåˆ†ç±»
                category = self._get_or_create_category(
                    trans_data['categoryId'],
                    trans_data['categoryName'],
                    trans_data['type']
                )

                # è·å–æˆ–åˆ›å»ºè´¦æˆ·
                account = self._get_or_create_account(user_id, 'å¾®ä¿¡')

                # åˆ›å»ºäº¤æ˜“è®°å½•
                transaction = Transaction(
                    user_id=user_id,
                    type=trans_data['type'],
                    amount=trans_data['amount'],
                    category_id=category.id,
                    account_id=account.id,
                    transaction_date=trans_data['transactionDate'],
                    remark=trans_data.get('remark', ''),
                    merchant_name=trans_data['merchantName'],
                    source='wechat',
                    wechat_transaction_id=trans_data.get('wechatTransactionId')
                )

                self.db.add(transaction)

                # æ›´æ–°è´¦æˆ·ä½™é¢
                if trans_data['type'] == 'expense':
                    account.balance -= trans_data['amount']
                else:
                    account.balance += trans_data['amount']

                success_count += 1

            except Exception as e:
                print(f"å¯¼å…¥äº¤æ˜“å¤±è´¥: {e}")
                fail_count += 1
                continue

        try:
            self.db.commit()
        except Exception as e:
            self.db.rollback()
            raise HTTPException(status_code=500, detail="ä¿å­˜æ•°æ®å¤±è´¥")

        return {
            'success': True,
            'successCount': success_count,
            'failCount': fail_count,
            'duplicateCount': duplicate_count,
            'totalCount': len(transactions)
        }

    def _get_or_create_category(self, category_id: int, category_name: str, trans_type: str):
        """è·å–æˆ–åˆ›å»ºåˆ†ç±»"""
        if category_id:
            category = self.db.query(Category).filter(Category.id == category_id).first()
            if category:
                return category

        # åˆ›å»ºæ–°åˆ†ç±»
        category = Category(
            name=category_name,
            type='expense' if trans_type == 'expense' else 'income',
            icon=self.category_service._get_category_icon(category_name),
            is_system=False
        )
        self.db.add(category)
        self.db.flush()  # è·å–IDä½†ä¸æäº¤
        return category

    def _get_or_create_account(self, user_id: int, account_name: str):
        """è·å–æˆ–åˆ›å»ºè´¦æˆ·"""
        account = self.db.query(Account).filter(
            Account.user_id == user_id,
            Account.name == account_name
        ).first()

        if not account:
            account = Account(
                user_id=user_id,
                name=account_name,
                type='wechat',
                balance=0,
                icon='ğŸ’š',
                is_default=True
            )
            self.db.add(account)
            self.db.flush()

        return account
```

æ™ºèƒ½åˆ†ç±»æœåŠ¡:
python# æ™ºèƒ½åˆ†ç±»æœåŠ¡
import re
from typing import Tuple, List
from sqlalchemy.orm import Session

class IntelligentCategoryService:
    def __init__(self, db: Session):
        self.db = db
        self._init_category_mapping()

    def _init_category_mapping(self):
        """åˆå§‹åŒ–åˆ†ç±»æ˜ å°„è§„åˆ™"""
        # å¾®ä¿¡åŸå§‹åˆ†ç±»æ˜ å°„
        self.wechat_category_map = {
            'é¤é¥®': 'é¤é¥®',
            'è´­ç‰©': 'è´­ç‰©',
            'äº¤é€šå‡ºè¡Œ': 'äº¤é€š',
            'ç”Ÿæ´»æœåŠ¡': 'å±…ä½',
            'å¨±ä¹ä¼‘é—²': 'å¨±ä¹',
            'åŒ»ç–—å¥åº·': 'åŒ»ç–—',
            'æ•™è‚²': 'å­¦ä¹ ',
            'é€šè®¯': 'é€šè®¯',
            'é‡‘èæœåŠ¡': 'å…¶ä»–',
            'å…¶ä»–': 'å…¶ä»–'
        }

        # å•†æˆ·å…³é”®è¯æ˜ å°„
        self.merchant_keywords = {
            'é¤é¥®': [
                'éº¦å½“åŠ³', 'è‚¯å¾·åŸº', 'æ˜Ÿå·´å…‹', 'ç‘å¹¸', 'å–œèŒ¶', 'å¥ˆé›ª', 'å¥¶èŒ¶',
                'ç¾å›¢', 'é¥¿äº†ä¹ˆ', 'ç›’é©¬', 'è¶…å¸‚', 'ä¾¿åˆ©åº—', 'æ°´æœåº—', ' bakery ',
                'å’–å•¡', 'é¤å…', 'é¥­åº—', 'å°åƒ', 'çƒ§çƒ¤', 'ç«é”…', 'æ—¥æ–™', 'è¥¿é¤'
            ],
            'äº¤é€š': [
                'æ»´æ»´', 'æ›¹æ“', 'é«˜å¾·', 'å‡ºç§Ÿè½¦', 'åœ°é“', 'å…¬äº¤', 'åŠ æ²¹', 'åœè½¦',
                'å……ç”µ', 'é«˜é€Ÿ', 'æœºç¥¨', 'ç«è½¦ç¥¨', 'é…’åº—', 'æ°‘å®¿'
            ],
            'è´­ç‰©': [
                'æ·˜å®', 'å¤©çŒ«', 'äº¬ä¸œ', 'æ‹¼å¤šå¤š', 'è‹å®', 'å›½ç¾', 'æœè£…', 'é‹å­',
                'åŒ–å¦†å“', 'æŠ¤è‚¤å“', 'ç”µå­äº§å“', 'æ‰‹æœº', 'ç”µè„‘', 'å®¶ç”µ'
            ],
            'å¨±ä¹': [
                'ç”µå½±', 'KTV', 'æ¸¸æˆ', 'è…¾è®¯', 'ç½‘æ˜“', 'Steam', 'è§†é¢‘', 'éŸ³ä¹',
                'æ—…æ¸¸', 'æ™¯ç‚¹', 'é—¨ç¥¨', 'æ¼”å‡º', 'å±•è§ˆ'
            ],
            'å­¦ä¹ ': [
                'è¯¾ç¨‹', 'åŸ¹è®­', 'ä¹¦ç±', 'æ–‡å…·', 'è€ƒè¯•', 'æ•™è‚²', 'å­¦æ ¡', 'å›¾ä¹¦é¦†'
            ],
            'åŒ»ç–—': [
                'åŒ»é™¢', 'è¯åº—', 'ä½“æ£€', 'çœ‹ç—…', 'æŒ‚å·', 'åŒ»ç–—', 'ä¿é™©'
            ],
            'å±…ä½': [
                'æˆ¿ç§Ÿ', 'æ°´ç”µ', 'ç‡ƒæ°”', 'ç‰©ä¸š', 'è£…ä¿®', 'å®¶å…·', 'æ—¥ç”¨å“'
            ],
            'é€šè®¯': [
                'è¯è´¹', 'å®½å¸¦', 'æµé‡', 'æ‰‹æœºå……å€¼', 'è”é€š', 'ç§»åŠ¨', 'ç”µä¿¡'
            ],
            'ç¤¾äº¤': [
                'çº¢åŒ…', 'è½¬è´¦', 'ç¤¼ç‰©', 'èšé¤', 'å©šç¤¼', 'ç”Ÿæ—¥'
            ]
        }

    def intelligent_match_category(self, merchant_name: str, wechat_category: str = '') -> Tuple[int, str]:
        """æ™ºèƒ½åŒ¹é…åˆ†ç±»"""
        merchant_name = merchant_name.lower().strip()

        # 1. ä¼˜å…ˆä½¿ç”¨å¾®ä¿¡åŸå§‹åˆ†ç±»
        if wechat_category and wechat_category in self.wechat_category_map:
            mapped_category = self.wechat_category_map[wechat_category]
            category_id, category_name = self._get_category_by_name(mapped_category)
            if category_id:
                return category_id, category_name

        # 2. å•†æˆ·å…³é”®è¯åŒ¹é…
        for category, keywords in self.merchant_keywords.items():
            for keyword in keywords:
                if keyword.lower() in merchant_name:
                    category_id, category_name = self._get_category_by_name(category)
                    if category_id:
                        return category_id, category_name

        # 3. ä½¿ç”¨å¾®ä¿¡åŸå§‹åˆ†ç±»
        if wechat_category:
            category_id, category_name = self._get_category_by_name(wechat_category)
            if category_id:
                return category_id, category_name

        # 4. é»˜è®¤å…¶ä»–
        return self._get_or_create_other_category()

    def _get_category_by_name(self, category_name: str) -> Tuple[Optional[int], Optional[str]]:
        """æ ¹æ®åˆ†ç±»åç§°è·å–åˆ†ç±»"""
        from app.models.category import Category

        category = self.db.query(Category).filter(
            Category.name == category_name,
            Category.is_system == True
        ).first()

        if category:
            return category.id, category.name
        return None, None

    def _get_or_create_other_category(self) -> Tuple[int, str]:
        """è·å–æˆ–åˆ›å»ºå…¶ä»–åˆ†ç±»"""
        from app.models.category import Category

        category = self.db.query(Category).filter(
            Category.name == 'å…¶ä»–',
            Category.type == 'expense'
        ).first()

        if not category:
            category = Category(
                name='å…¶ä»–',
                type='expense',
                icon='ğŸ“¦',
                is_system=True,
                sort_order=999
            )
            self.db.add(category)
            self.db.flush()

        return category.id, category.name

    def _get_category_icon(self, category_name: str) -> str:
        """è·å–åˆ†ç±»å›¾æ ‡"""
        icon_map = {
            'é¤é¥®': 'ğŸ”',
            'äº¤é€š': 'ğŸš‡',
            'è´­ç‰©': 'ğŸ›’',
            'å¨±ä¹': 'ğŸ®',
            'å­¦ä¹ ': 'ğŸ“š',
            'åŒ»ç–—': 'ğŸ¥',
            'å±…ä½': 'ğŸ ',
            'é€šè®¯': 'ğŸ“±',
            'ç¤¾äº¤': 'ğŸ‘¥',
            'å…¶ä»–': 'ğŸ“¦'
        }
        return icon_map.get(category_name, 'ğŸ“¦')

# APIè·¯ç”±
from fastapi import APIRouter, Depends, UploadFile, File, HTTPException
from app.core.dependencies import get_current_user
from app.models.user import User
from app.db.database import get_db

router = APIRouter(prefix="/api/wechat-bill", tags=["å¾®ä¿¡è´¦å•"])

@router.post("/parse")
async def parse_wechat_bill(
    file: UploadFile = File(...),
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """è§£æå¾®ä¿¡è´¦å•CSVæ–‡ä»¶"""
    if not file.filename.lower().endswith('.csv'):
        raise HTTPException(status_code=400, detail="åªæ”¯æŒCSVæ ¼å¼æ–‡ä»¶")

    service = WeChatBillService(db)
    transactions = await service.parse_wechat_csv(file)

    return {
        "code": 200,
        "message": "success",
        "data": transactions
    }

@router.post("/import")
async def import_wechat_transactions(
    transactions: List[Dict],
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    """å¯¼å…¥å¾®ä¿¡äº¤æ˜“è®°å½•"""
    service = WeChatBillService(db)
    result = await service.import_transactions(current_user.id, transactions)

    return {
        "code": 200,
        "message": "success",
        "data": result
    }
```

æ•°æ®åº“è®¾è®¡æ‰©å±•:
sql-- åœ¨transactionsè¡¨æ–°å¢å¾®ä¿¡ç›¸å…³å­—æ®µ
ALTER TABLE transactions ADD COLUMN source VARCHAR(20) DEFAULT 'manual' COMMENT 'æ•°æ®æ¥æº(manual/wechat/alipay)';
ALTER TABLE transactions ADD COLUMN merchant_name VARCHAR(100) COMMENT 'å•†æˆ·åç§°';
ALTER TABLE transactions ADD COLUMN wechat_transaction_id VARCHAR(100) COMMENT 'å¾®ä¿¡äº¤æ˜“ID';
ALTER TABLE transactions ADD COLUMN product_name VARCHAR(200) COMMENT 'å•†å“åç§°';

-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_wechat_transaction_id ON transactions(wechat_transaction_id);
CREATE INDEX idx_source ON transactions(source);

-- åˆ›å»ºå¯¼å…¥æ—¥å¿—è¡¨
CREATE TABLE import_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    source VARCHAR(20) NOT NULL COMMENT 'æ•°æ®æ¥æº',
    total_count INT NOT NULL COMMENT 'æ€»è®°å½•æ•°',
    success_count INT NOT NULL COMMENT 'æˆåŠŸå¯¼å…¥æ•°',
    duplicate_count INT DEFAULT 0 COMMENT 'é‡å¤è®°å½•æ•°',
    fail_count INT DEFAULT 0 COMMENT 'å¤±è´¥è®°å½•æ•°',
    import_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

å‰ç«¯è·¯ç”±å’Œé¡µé¢:
javascript// router/index.ts æ–°å¢è·¯ç”±
{
  path: '/wechat-import',
  name: 'WechatImport',
  component: () => import('@/views/wechat/WechatImport.vue'),
  meta: { requiresAuth: true }
}

// views/wechat/WechatImport.vue - å®Œæ•´çš„å¾®ä¿¡è´¦å•å¯¼å…¥é¡µé¢
```

2.9 æ™ºèƒ½æé†’æ¨¡å—
2.9.1 æé†’ç±»å‹

è®°è´¦æé†’

æ¯æ™š9ç‚¹æé†’ä»Šå¤©æ˜¯å¦è®°è´¦
æ£€æµ‹åˆ°ä»Šå¤©æ— è®°å½•æ—¶è§¦å‘


é¢„ç®—é¢„è­¦

è¾¾åˆ°é¢„ç®—é˜ˆå€¼æ—¶æ¨é€
æ¯å¤©æ£€æŸ¥ä¸€æ¬¡


è´¦å•å¯¼å…¥æé†’

æ¯æœˆ1æ—¥æé†’å¯¼å…¥ä¸Šæœˆå¾®ä¿¡è´¦å•
æ£€æµ‹åˆ°é•¿æ—¶é—´æœªå¯¼å…¥è´¦å•æ—¶æé†’


æ•°æ®åˆ†ææŠ¥å‘Š

æ¯æœˆ1æ—¥æ¨é€ä¸Šæœˆæ€»ç»“
æ¯å‘¨ä¸€æ¨é€ä¸Šå‘¨åˆ†æ



æ•°æ®åº“è®¾è®¡:
sqlCREATE TABLE reminders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    type ENUM('daily', 'budget', 'recurring', 'report', 'import') NOT NULL,
    title VARCHAR(100),
    content TEXT,
    remind_time TIME, -- æé†’æ—¶é—´
    remind_day INT, -- æ¯æœˆç¬¬å‡ å¤©(å¾ªç¯æé†’)
    category_id INT NULL, -- å…³è”åˆ†ç±»(é¢„ç®—æé†’)
    is_enabled BOOLEAN DEFAULT TRUE,
    last_reminded_at DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## ä¸‰ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ

**æ¡†æ¶é€‰å‹:**
```
Vue 3 + TypeScript
â”œâ”€â”€ çŠ¶æ€ç®¡ç†: Pinia
â”œâ”€â”€ è·¯ç”±: Vue Router 4
â”œâ”€â”€ UIç»„ä»¶åº“: Element Plus (PCç«¯) / Vant (ç§»åŠ¨ç«¯)
â”œâ”€â”€ å›¾è¡¨åº“: ECharts 5
â”œâ”€â”€ HTTPå®¢æˆ·ç«¯: Axios
â”œâ”€â”€ æ—¥æœŸå¤„ç†: Day.js
â”œâ”€â”€ è¡¨å•éªŒè¯: VeeValidate
â”œâ”€â”€ Excelå¯¼å‡º: SheetJS (xlsx)
â””â”€â”€ æ„å»ºå·¥å…·: Vite
```

**é¡¹ç›®ç»“æ„:**
```
src/
â”œâ”€â”€ assets/          # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ styles/
â”œâ”€â”€ components/      # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ CategoryIcon.vue      # åˆ†ç±»å›¾æ ‡
â”‚   â”‚   â”œâ”€â”€ AmountInput.vue       # é‡‘é¢è¾“å…¥
â”‚   â”‚   â””â”€â”€ DatePicker.vue        # æ—¥æœŸé€‰æ‹©
â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”œâ”€â”€ PieChart.vue          # é¥¼å›¾
â”‚   â”‚   â”œâ”€â”€ LineChart.vue         # æŠ˜çº¿å›¾
â”‚   â”‚   â””â”€â”€ BarChart.vue          # æŸ±çŠ¶å›¾
â”‚   â””â”€â”€ layout/
â”‚       â”œâ”€â”€ Header.vue
â”‚       â”œâ”€â”€ Sidebar.vue
â”‚       â””â”€â”€ BottomNav.vue         # ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆª
â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ Login.vue
â”‚   â”‚   â””â”€â”€ Register.vue
â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â””â”€â”€ Dashboard.vue         # é¦–é¡µä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ transaction/
â”‚   â”‚   â”œâ”€â”€ TransactionList.vue   # è´¦å•åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ AddTransaction.vue    # æ·»åŠ è´¦å•
â”‚   â”‚   â””â”€â”€ TransactionDetail.vue # è´¦å•è¯¦æƒ…
â”‚   â”œâ”€â”€ statistics/
â”‚   â”‚   â”œâ”€â”€ Overview.vue          # ç»Ÿè®¡æ€»è§ˆ
â”‚   â”‚   â””â”€â”€ CategoryAnalysis.vue  # åˆ†ç±»åˆ†æ
â”‚   â”œâ”€â”€ budget/
â”‚   â”‚   â”œâ”€â”€ BudgetList.vue        # é¢„ç®—åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ BudgetSetting.vue     # é¢„ç®—è®¾ç½®
â”‚   â”œâ”€â”€ account/
â”‚   â”‚   â”œâ”€â”€ AccountList.vue       # è´¦æˆ·åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ AccountDetail.vue     # è´¦æˆ·è¯¦æƒ…
â”‚   â””â”€â”€ settings/
â”‚       â””â”€â”€ Settings.vue          # è®¾ç½®é¡µé¢
â”œâ”€â”€ router/          # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ store/           # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ user.ts              # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ transaction.ts       # äº¤æ˜“çŠ¶æ€
â”‚   â”‚   â””â”€â”€ budget.ts            # é¢„ç®—çŠ¶æ€
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ api/             # APIæ¥å£
â”‚   â”œâ”€â”€ auth.ts
â”‚   â”œâ”€â”€ transaction.ts
â”‚   â”œâ”€â”€ statistics.ts
â”‚   â”œâ”€â”€ budget.ts
â”‚   â””â”€â”€ account.ts
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ request.ts               # Axioså°è£…
â”‚   â”œâ”€â”€ auth.ts                  # Tokenç®¡ç†
â”‚   â”œâ”€â”€ format.ts                # æ ¼å¼åŒ–å·¥å…·
â”‚   â””â”€â”€ validate.ts              # éªŒè¯å·¥å…·
â”œâ”€â”€ types/           # TypeScriptç±»å‹
â”‚   â”œâ”€â”€ transaction.ts
â”‚   â”œâ”€â”€ budget.ts
â”‚   â””â”€â”€ user.ts
â”œâ”€â”€ App.vue
â””â”€â”€ main.ts
```

---

### 3.2 åç«¯æŠ€æœ¯æ ˆ

**æ¨èæ–¹æ¡ˆ: FastAPI**
```
FastAPI
â”œâ”€â”€ æ•°æ®åº“: MySQL 8.0 + SQLAlchemy/SQLModel
â”œâ”€â”€ ç¼“å­˜: Redis
â”œâ”€â”€ è®¤è¯: python-jose + passlib (JWT)
â”œâ”€â”€ æ–‡æ¡£: è‡ªåŠ¨ç”Ÿæˆ OpenAPI/Swagger
â”œâ”€â”€ å·¥å…·:
â”‚   â”œâ”€â”€ Pydantic (æ•°æ®éªŒè¯)
â”‚   â”œâ”€â”€ Alembic (æ•°æ®åº“è¿ç§»)
â”‚   â””â”€â”€ openpyxl (Excelå¯¼å‡º)
â””â”€â”€ æµ‹è¯•: pytest + httpx
```

**é¡¹ç›®ç»“æ„:**
```
app/
â”œâ”€â”€ main.py                      # FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py              # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ redis.py                 # Redisé…ç½®
â”‚   â””â”€â”€ settings.py              # åº”ç”¨è®¾ç½®
â”œâ”€â”€ api/                         # API è·¯ç”±
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py                  # è®¤è¯ç›¸å…³æ¥å£
â”‚   â”œâ”€â”€ transactions.py          # äº¤æ˜“è®°å½•æ¥å£
â”‚   â”œâ”€â”€ statistics.py            # ç»Ÿè®¡åˆ†ææ¥å£
â”‚   â”œâ”€â”€ budgets.py               # é¢„ç®—ç®¡ç†æ¥å£
â”‚   â””â”€â”€ accounts.py              # è´¦æˆ·ç®¡ç†æ¥å£
â”œâ”€â”€ models/                      # SQLAlchemy æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ transaction.py
â”‚   â”œâ”€â”€ category.py
â”‚   â”œâ”€â”€ account.py
â”‚   â””â”€â”€ budget.py
â”œâ”€â”€ schemas/                     # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ transaction.py
â”‚   â”œâ”€â”€ category.py
â”‚   â”œâ”€â”€ account.py
â”‚   â””â”€â”€ budget.py
â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth_service.py
â”‚   â”œâ”€â”€ transaction_service.py
â”‚   â”œâ”€â”€ statistics_service.py
â”‚   â”œâ”€â”€ budget_service.py
â”‚   â””â”€â”€ account_service.py
â”œâ”€â”€ core/                        # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ security.py              # å®‰å…¨ç›¸å…³
â”‚   â”œâ”€â”€ dependencies.py          # ä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ exceptions.py            # å¼‚å¸¸å¤„ç†
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ jwt_utils.py             # JWTå·¥å…·
â”‚   â”œâ”€â”€ date_utils.py            # æ—¥æœŸå·¥å…·
â”‚   â””â”€â”€ excel_utils.py           # Excelå·¥å…·
â””â”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_auth.py
    â”œâ”€â”€ test_transactions.py
    â””â”€â”€ conftest.py
```

3.3 æ•°æ®åº“è®¾è®¡å®Œæ•´ç‰ˆ
sql-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    avatar VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- åˆ†ç±»è¡¨
CREATE TABLE categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    type ENUM('income', 'expense') NOT NULL,
    icon VARCHAR(50),
    color VARCHAR(20),
    parent_id INT NULL,
    sort_order INT DEFAULT 0,
    is_system BOOLEAN DEFAULT FALSE, -- æ˜¯å¦ç³»ç»Ÿé¢„è®¾åˆ†ç±»
    INDEX idx_type (type)
);

-- è´¦æˆ·è¡¨
CREATE TABLE accounts (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    name VARCHAR(50) NOT NULL,
    type ENUM('cash', 'bank', 'wechat', 'alipay', 'meal_card', 'other') NOT NULL,
    balance DECIMAL(10,2) DEFAULT 0,
    initial_balance DECIMAL(10,2) DEFAULT 0,
    icon VARCHAR(50),
    color VARCHAR(20),
    is_default BOOLEAN DEFAULT FALSE,
    is_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user (user_id)
);

-- äº¤æ˜“è®°å½•è¡¨
CREATE TABLE transactions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    type ENUM('income', 'expense', 'transfer') NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    category_id INT NOT NULL,
    account_id INT NOT NULL,
    to_account_id INT NULL,
    transaction_date DATETIME NOT NULL,
    remark VARCHAR(200),
    images JSON, -- å­˜å‚¨å›¾ç‰‡URLæ•°ç»„
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id),
    FOREIGN KEY (account_id) REFERENCES accounts(id),
    INDEX idx_user_date (user_id, transaction_date),
    INDEX idx_category (category_id),
    INDEX idx_type (type)
);

-- é¢„ç®—è¡¨
CREATE TABLE budgets (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    category_id INT NULL,
    amount DECIMAL(10,2) NOT NULL,
    period_type ENUM('monthly', 'yearly') NOT NULL,
    year INT NOT NULL,
    month INT NULL, -- æœˆåº¦é¢„ç®—æ—¶ä½¿ç”¨
    alert_threshold INT DEFAULT 80,
    is_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (category_id) REFERENCES categories(id),
    UNIQUE KEY uk_budget (user_id, category_id, year, month),
    INDEX idx_user_period (user_id, year, month)
);

-- æé†’è¡¨
CREATE TABLE reminders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    type ENUM('daily', 'budget', 'recurring', 'report') NOT NULL,
    title VARCHAR(100),
    content TEXT,
    remind_time TIME,
    remind_day INT, -- æ¯æœˆç¬¬å‡ å¤©
    category_id INT NULL,
    amount DECIMAL(10,2) NULL, -- å›ºå®šé‡‘é¢æé†’
    is_enabled BOOLEAN DEFAULT TRUE,
    last_reminded_at DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_type (user_id, type)
);

-- ç»Ÿè®¡ç¼“å­˜è¡¨(å¯é€‰,ç”¨äºåŠ é€ŸæŸ¥è¯¢)
CREATE TABLE statistics_cache (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    stat_type VARCHAR(50) NOT NULL, -- 'monthly_summary', 'category_summary'ç­‰
    period VARCHAR(20) NOT NULL, -- '2024-12', '2024'ç­‰
    data JSON NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_stat (user_id, stat_type, period),
    INDEX idx_user (user_id)
);
```

---

### 3.4 æ ¸å¿ƒAPIæ¥å£è®¾è®¡

#### 3.4.1 è®¤è¯ç›¸å…³
```
POST   /api/auth/register        # ç”¨æˆ·æ³¨å†Œ
POST   /api/auth/login           # ç”¨æˆ·ç™»å½•
POST   /api/auth/logout          # ç”¨æˆ·ç™»å‡º
POST   /api/auth/refresh-token   # åˆ·æ–°Token
POST   /api/auth/forgot-password # å¿˜è®°å¯†ç 
```

#### 3.4.2 äº¤æ˜“ç›¸å…³
```
GET    /api/transactions                 # è·å–äº¤æ˜“åˆ—è¡¨(æ”¯æŒç­›é€‰)
GET    /api/transactions/:id             # è·å–äº¤æ˜“è¯¦æƒ…
POST   /api/transactions                 # æ·»åŠ äº¤æ˜“
PUT    /api/transactions/:id             # æ›´æ–°äº¤æ˜“
DELETE /api/transactions/:id             # åˆ é™¤äº¤æ˜“
POST   /api/transactions/transfer        # è´¦æˆ·è½¬è´¦
GET    /api/transactions/summary         # è·å–æ±‡æ€»ä¿¡æ¯
æ·»åŠ äº¤æ˜“æ¥å£ç¤ºä¾‹:
json// Request
POST /api/transactions
{
  "type": "expense",
  "amount": 35.5,
  "categoryId": 1,
  "accountId": 2,
  "transactionDate": "2024-12-12 12:30:00",
  "remark": "éº¦å½“åŠ³åˆé¤"
}

// Response
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 12345,
    "type": "expense",
    "amount": 35.5,
    "category": {
      "id": 1,
      "name": "é¤é¥®",
      "icon": "ğŸ”"
    },
    "account": {
      "id": 2,
      "name": "å¾®ä¿¡",
      "balance": 1964.5
    },
    "transactionDate": "2024-12-12 12:30:00",
    "remark": "éº¦å½“åŠ³åˆé¤",
    "createdAt": "2024-12-12 12:31:00"
  }
}
```

#### 3.4.3 ç»Ÿè®¡ç›¸å…³
```
GET /api/statistics/overview          # é¦–é¡µæ¦‚è§ˆæ•°æ®
GET /api/statistics/trend             # è¶‹åŠ¿æ•°æ®
GET /api/statistics/category          # åˆ†ç±»ç»Ÿè®¡
GET /api/statistics/account           # è´¦æˆ·ç»Ÿè®¡
GET /api/statistics/monthly-report    # æœˆåº¦æŠ¥è¡¨
GET /api/statistics/export/excel      # å¯¼å‡ºExcel
GET /api/statistics/export/pdf        # å¯¼å‡ºPDF
é¦–é¡µæ¦‚è§ˆæ¥å£ç¤ºä¾‹:
json// Request
GET /api/statistics/overview?period=2024-12

// Response
{
  "code": 200,
  "data": {
    "period": "2024-12",
    "income": {
      "amount": 5000,
      "count": 2,
      "change": 12.5  // ç¯æ¯”å¢é•¿%
    },
    "expense": {
      "amount": 3245,
      "count": 156,
      "change": -5.2
    },
    "balance": 1755,
    "topCategories": [
      {
        "categoryId": 1,
        "categoryName": "é¤é¥®",